(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{240:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"dhcp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dhcp"}},[t._v("#")]),t._v(" DHCP")]),t._v(" "),a("p",[t._v("动态主机配置协议（DHCP) - dynamic host configuration protocol")]),t._v(" "),a("h2",{attrs:{id:"如何配置-ip-地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何配置-ip-地址"}},[t._v("#")]),t._v(" 如何配置 IP 地址")]),t._v(" "),a("blockquote",[a("p",[t._v("手动配置")])]),t._v(" "),a("ul",[a("li",[t._v("net-tools")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ifconfig")]),t._v(" eth1 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.0")]),t._v(".0.1/24\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ifconfig")]),t._v(" eth1 up\n")])])]),a("ul",[a("li",[t._v("iproute2")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ip")]),t._v(" addr "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.0")]),t._v(".0.1/24\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ip")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" up eth1\n")])])]),a("blockquote",[a("p",[t._v("配置文件")])]),t._v(" "),a("p",[a("code",[t._v("CIDR 子网掩码 广播地址 网关地址")])]),t._v(" "),a("h2",{attrs:{id:"动态主机配置协议（dhcp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态主机配置协议（dhcp"}},[t._v("#")]),t._v(" 动态主机配置协议（DHCP)")]),t._v(" "),a("p",[t._v("形象举例：租房 -> 退租")]),t._v(" "),a("blockquote",[a("p",[t._v("广播包分配一个地址")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th")])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("MAC 头")]),t._v(" "),a("td",[t._v("广播 MAC(ff:ff:ff:ff:ff:ff)")])]),t._v(" "),a("tr",[a("td",[t._v("IP 头")]),t._v(" "),a("td",[t._v("广播 IP 255.255.255.255")])]),t._v(" "),a("tr",[a("td",[t._v("UDP 头")]),t._v(" "),a("td",[t._v("源端口： 68 "),a("br"),t._v(" 目标端口 67")])]),t._v(" "),a("tr",[a("td",[t._v("BOOTP")]),t._v(" "),a("td",[t._v("BOOT request")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("我的 MAC 是这个，我还没有 IP")])])])]),t._v(" "),a("p",[t._v(":::warn BOOTP\n广播包封装了 UDP，UDP 封装了 BOOTP，DHCP 是 BOOTP 的增强版\n:::")]),t._v(" "),a("blockquote",[a("p",[t._v("DHCP offer")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th")])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("MAC 头")]),t._v(" "),a("td",[t._v("广播 MAC(ff:ff:ff:ff:ff:ff)")])]),t._v(" "),a("tr",[a("td",[t._v("IP 头")]),t._v(" "),a("td",[t._v("DHCP SERVER 的 IP：0.0.0.0 "),a("br"),t._v(" 广播 IP 255.255.255.255")])]),t._v(" "),a("tr",[a("td",[t._v("UDP 头")]),t._v(" "),a("td",[t._v("源端口： 68 "),a("br"),t._v(" 目标端口 67")])]),t._v(" "),a("tr",[a("td",[t._v("BOOTP")]),t._v(" "),a("td",[t._v("BOOT reply")])]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("这是你的 MAC，我分配了这个 IP，租给你")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("DHCP request")])]),t._v(" "),a("p",[t._v("确认是否租用(接收 DHCP offer)")]),t._v(" "),a("blockquote",[a("p",[t._v("ACK")])]),t._v(" "),a("p",[t._v("当 DHCP Server 接收到客户机的 DHCP request 之后，广播返回给客户机一个 DHCP ACK 消息包，表明已经接受客户机的选择，并将 IP 地址的合法租用信息和其他配置的信息放入广播包")]),t._v(" "),a("blockquote",[a("p",[t._v("IP 地址的收回和续租")])]),t._v(" "),a("p",[t._v("DHCP request <-> DHCP ACK 更新配置")]),t._v(" "),a("h2",{attrs:{id:"pxe"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pxe"}},[t._v("#")]),t._v(" PXE")]),t._v(" "),a("p",[t._v("预启动执行环境 Pre-boot Execution Environment")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("PXE")]),t._v(" "),a("p",[t._v("PXE 协议氛围客户端服务器端 "),a("br"),t._v("\n客户端在 BIOS, 启动 BIOS 把 PXE 客户端调入内存，可以连接服务端")])]),t._v(" "),a("ul",[a("li",[t._v("系统")])]),t._v(" "),a("p",[t._v("MBR 启动 GRUB -> GRUB 加载内核、加载作为根文件系统的 initramfs 文件 -> 内核启动")]),t._v(" "),a("h3",{attrs:{id:"原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[t._v("#")]),t._v(" 原理")]),t._v(" "),a("ul",[a("li",[t._v("PXE 客户端需要有个 IP 地址")]),t._v(" "),a("li",[t._v("DHCP request")]),t._v(" "),a("li",[t._v("DHCP server ACK")]),t._v(" "),a("li",[t._v("配置文件")])]),t._v(" "),a("p",[t._v("DHCP Server 配置(IP 地址段 子网掩码 网关地址 租期)")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ddns-update-style interim"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nignore client-updates"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nallow booting"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nallow bootp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsubnet "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.0 netmask "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("255.255")]),t._v(".255.0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\toption routers "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\toption subnet-mask "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("255.255")]),t._v(".255.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\toption time-offset -18000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tdefault-lease-time "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21600")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tmax-lease-time "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("43200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\trange dynamic-bootp "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.240 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.250"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tfilename "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pxelinux.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tnext-server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.180"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("next-server")])]),t._v(" "),a("p",[t._v("要使用 PXE，需要配置 next-server，指向 PXE 服务器的地址，另外要配置初始启动文件 filename")]),t._v(" "),a("h3",{attrs:{id:"pxe-工作过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pxe-工作过程"}},[t._v("#")]),t._v(" PXE 工作过程")]),t._v(" "),a("ol",[a("li",[t._v("启动 PXE 客户端")]),t._v(" "),a("li",[t._v("DHCP Server 分配一个 IP 地址、PXE 服务器的地址、启动文件 pxelinus.0")]),t._v(" "),a("li",[t._v("PXE 客户端向 TFTP 服务器请求下载文件")]),t._v(" "),a("li",[t._v("下载完毕，执行文件（文件会指向 PXE 客户端，向 TFTP 服务器请求计算机的配置信息 pxelinux.cfg），TFTP 服务器会给 PXE 客户端一个配置文件包括内核、initramfs，PXE 客户端会请求这些文件")]),t._v(" "),a("li",[t._v("启动 Linux 内核")])])])}),[],!1,null,null,null);s.default=e.exports}}]);